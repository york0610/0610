{"version":3,"file":"index.mjs","sources":["../../src/index.tsx"],"sourcesContent":["/* eslint-disable no-return-assign */\n/* eslint-disable no-underscore-dangle */\nimport * as React from 'react'\nimport useLayoutEffect from '@react-hook/passive-layout-effect'\nimport useLatest from '@react-hook/latest'\n\n/**\n * A React hook that fires a callback whenever ResizeObserver detects a change to its size\n *\n * @param target A React ref created by `useRef()` or an HTML element\n * @param callback Invoked with a single `ResizeObserverEntry` any time\n *   the `target` resizes\n */\nfunction useResizeObserver<T extends Element>(\n  target: React.RefObject<T> | React.ForwardedRef<T> | T | null,\n  callback: UseResizeObserverCallback,\n  options: UseResizeObserverOptions = {}\n): ResizeObserver {\n  const resizeObserver = getResizeObserver(options.polyfill)\n  const storedCallback = useLatest(callback)\n\n  useLayoutEffect(() => {\n    let didUnsubscribe = false\n    const targetEl = target && 'current' in target ? target.current : target\n    if (!targetEl) return () => {}\n\n    function cb(entry: ResizeObserverEntry, observer: ResizeObserver) {\n      if (didUnsubscribe) return\n      storedCallback.current(entry, observer)\n    }\n\n    resizeObserver.subscribe(targetEl as Element, cb)\n\n    return () => {\n      didUnsubscribe = true\n      resizeObserver.unsubscribe(targetEl as Element, cb)\n    }\n  }, [target, resizeObserver, storedCallback])\n\n  return resizeObserver.observer\n}\n\nfunction createResizeObserver(polyfill?: any) {\n  let ticking = false\n  let allEntries: ResizeObserverEntry[] = []\n\n  const callbacks: Map<any, Array<UseResizeObserverCallback>> = new Map()\n\n  const observer = new (polyfill || window.ResizeObserver)(\n    (entries: ResizeObserverEntry[], obs: ResizeObserver) => {\n      allEntries = allEntries.concat(entries)\n      if (!ticking) {\n        window.requestAnimationFrame(() => {\n          const triggered = new Set<Element>()\n          for (let i = 0; i < allEntries.length; i++) {\n            if (triggered.has(allEntries[i].target)) continue\n            triggered.add(allEntries[i].target)\n            const cbs = callbacks.get(allEntries[i].target)\n            cbs?.forEach((cb) => cb(allEntries[i], obs))\n          }\n          allEntries = []\n          ticking = false\n        })\n      }\n      ticking = true\n    }\n  )\n\n  return {\n    observer,\n    subscribe(target: Element, callback: UseResizeObserverCallback) {\n      observer.observe(target)\n      const cbs = callbacks.get(target) ?? []\n      cbs.push(callback)\n      callbacks.set(target, cbs)\n    },\n    unsubscribe(target: Element, callback: UseResizeObserverCallback) {\n      const cbs = callbacks.get(target) ?? []\n      if (cbs.length === 1) {\n        observer.unobserve(target)\n        callbacks.delete(target)\n        return\n      }\n      const cbIndex = cbs.indexOf(callback)\n      if (cbIndex !== -1) cbs.splice(cbIndex, 1)\n      callbacks.set(target, cbs)\n    },\n  }\n}\n\nlet _resizeObserver: ReturnType<typeof createResizeObserver>\n\nconst getResizeObserver = (polyfill: any) =>\n  !_resizeObserver\n    ? (_resizeObserver = createResizeObserver(polyfill))\n    : _resizeObserver\n\nexport type UseResizeObserverCallback = (\n  entry: ResizeObserverEntry,\n  observer: ResizeObserver\n) => any\n\nexport type UseResizeObserverOptions = {polyfill?: any}\nexport default useResizeObserver\n"],"names":["_ref","useResizeObserver","target","callback","options","resizeObserver","getResizeObserver","polyfill","storedCallback","useLatest","useLayoutEffect","cb","entry","observer","didUnsubscribe","current","targetEl","subscribe","unsubscribe","_resizeObserver","ticking","allEntries","callbacks","Map","window","ResizeObserver","entries","obs","concat","requestAnimationFrame","triggered","Set","_loop","i","has","add","cbs","get","forEach","length","_callbacks$get","observe","push","set","_callbacks$get2","unobserve","delete","cbIndex","indexOf","splice","createResizeObserver"],"mappings":"AAwB0B,SAAAA,IAAO,CAXjC,SAASC,EACPC,EACAC,EACAC,QAAiC,IAAjCA,IAAAA,EAAoC,CAAA,GAEpC,IAAMC,EAAiBC,EAAkBF,EAAQG,UAC3CC,EAAiBC,EAAUN,GAoBjC,OAlBAO,GAAgB,KAKd,SAASC,EAAGC,EAA4BC,GAClCC,GACJN,EAAeO,QAAQH,EAAOC,EAChC,CAPA,IAAIC,EAAiB,EACfE,EAAWd,GAAU,YAAaA,EAASA,EAAOa,QAAUb,EAClE,OAAKc,GAOLX,EAAeY,UAAUD,EAAqBL,GAEvC,KACLG,EAAiB,EACjBT,EAAea,YAAYF,EAAqBL,EAAG,GAXtCX,CAYd,GACA,CAACE,EAAQG,EAAgBG,IAErBH,EAAeQ,QACxB,oFAkDA,IAAIM,EAEEb,EAAqBC,GACxBY,IACIA,EApDP,SAA8BZ,GAC5B,IAAIa,EAAU,EACVC,EAAoC,GAElCC,EAAwD,IAAIC,IAE5DV,EAAW,IAAKN,GAAYiB,OAAOC,iBACvC,CAACC,EAAgCC,KAC/BN,EAAaA,EAAWO,OAAOF,GAC1BN,GACHI,OAAOK,uBAAsB,WAE3B,IADA,IAAMC,EAAY,IAAIC,IAAcC,EAAAA,SAC3BC,GACP,GAAIH,EAAUI,IAAIb,EAAWY,GAAG/B,QAAS,MAAA,WACzC4B,EAAUK,IAAId,EAAWY,GAAG/B,QAC5B,IAAMkC,EAAMd,EAAUe,IAAIhB,EAAWY,GAAG/B,QACxCkC,SAAAA,EAAKE,SAAS3B,GAAOA,EAAGU,EAAWY,GAAIN,IAAK,EAJrCM,EAAI,EAAGA,EAAIZ,EAAWkB,OAAQN,IAAKD,EAAnCC,GAMTZ,EAAa,GACbD,EAAU,CACZ,IAEFA,EAAU,CAAI,IAIlB,MAAO,CACLP,WACAI,SAAAA,CAAUf,EAAiBC,GAAqC,IAAAqC,EAC9D3B,EAAS4B,QAAQvC,GACjB,IAAMkC,EAA2BI,QAAxBA,EAAGlB,EAAUe,IAAInC,UAAOsC,IAAAA,EAAAA,EAAI,GACrCJ,EAAIM,KAAKvC,GACTmB,EAAUqB,IAAIzC,EAAQkC,EACvB,EACDlB,WAAAA,CAAYhB,EAAiBC,GAAqC,IAAAyC,EAC1DR,EAA2BQ,QAAxBA,EAAGtB,EAAUe,IAAInC,UAAO0C,IAAAA,EAAAA,EAAI,GACrC,GAAmB,IAAfR,EAAIG,OAGN,OAFA1B,EAASgC,UAAU3C,QACnBoB,EAAUwB,OAAO5C,GAGnB,IAAM6C,EAAUX,EAAIY,QAAQ7C,IACX,IAAb4C,GAAgBX,EAAIa,OAAOF,EAAS,GACxCzB,EAAUqB,IAAIzC,EAAQkC,EACxB,EAEJ,CAMyBc,CAAqB3C"}