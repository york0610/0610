!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).wretch=t()}(this,(function(){"use strict";const e="Content-Type",t=Symbol(),r=Symbol();function o(t={}){var r;const o=t instanceof Array?Object.fromEntries(t):t;return null===(r=Object.entries(o).find((([t])=>t.toLowerCase()===e.toLowerCase())))||void 0===r?void 0:r[1]}function s(e){return/^application\/.*json.*/.test(e)}const n=function(e,t,r=0){return Object.entries(t).reduce(((t,[o,s])=>{const i=e[o];return Array.isArray(i)&&Array.isArray(s)?t[o]=r?[...i,...s]:s:t[o]="object"==typeof i&&"object"==typeof s?n(i,s,r):s,t}),{...e})},i={options:{},errorType:"text",polyfills:{},polyfill(e,t=1,r=0,...o){const s=this.polyfills[e]||("undefined"!=typeof self?self[e]:null)||("undefined"!=typeof global?global[e]:null);if(t&&!s)throw new Error(e+" is not defined");return r&&s?new s(...o):s}};class c extends Error{}const l=e=>{const o=Object.create(null);e=e._addons.reduce(((t,r)=>r.beforeRequest&&r.beforeRequest(t,e._options,o)||t),e);const{_url:s,_options:i,_config:l,_catchers:h,_resolvers:u,_middlewares:a,_addons:f}=e,d=new Map(h),p=n(l.options,i);let y=s;const _=(e=>t=>e.reduceRight(((e,t)=>t(e)),t)||t)(a)(((e,t)=>(y=e,l.polyfill("fetch")(e,t))))(s,p),b=new Error,g=_.catch((e=>{throw{[t]:e}})).then((e=>{var t;if(!e.ok){const r=new c;if(r.cause=b,r.stack=r.stack+"\nCAUSE: "+b.stack,r.response=e,r.status=e.status,r.url=y,"opaque"===e.type)throw r;const o="json"===l.errorType||"application/json"===(null===(t=e.headers.get("Content-Type"))||void 0===t?void 0:t.split(";")[0]);return(l.errorType?o?e.text():e[l.errorType]():Promise.resolve(e.body)).then((t=>{if(r.message="string"==typeof t?t:e.statusText,t)if(o&&"string"==typeof t){r.text=t;try{r.json=JSON.parse(t)}catch(e){}}else r[l.errorType]=t;throw r}))}return e})),w=o=>s=>(o?g.then((e=>e&&e[o]())).then((e=>s?s(e):e)):g.then((e=>s?s(e):e))).catch((o=>{const s=Object.prototype.hasOwnProperty.call(o,t),n=s?o[t]:o,i=(null==n?void 0:n.status)&&d.get(n.status)||d.get(null==n?void 0:n.name)||s&&d.has(t)&&d.get(t);if(i)return i(n,e);const c=d.get(r);if(c)return c(n,e);throw n})),m={_wretchReq:e,_fetchReq:_,_sharedState:o,res:w(null),json:w("json"),blob:w("blob"),formData:w("formData"),arrayBuffer:w("arrayBuffer"),text:w("text"),error(e,t){return d.set(e,t),this},badRequest(e){return this.error(400,e)},unauthorized(e){return this.error(401,e)},forbidden(e){return this.error(403,e)},notFound(e){return this.error(404,e)},timeout(e){return this.error(408,e)},internalError(e){return this.error(500,e)},fetchError(e){return this.error(t,e)}},j=f.reduce(((e,t)=>({...e,..."function"==typeof t.resolver?t.resolver(e):t.resolver})),m);return u.reduce(((t,r)=>r(t,e)),j)},h={_url:"",_options:{},_config:i,_catchers:new Map,_resolvers:[],_deferred:[],_middlewares:[],_addons:[],addon(e){return{...this,_addons:[...this._addons,e],...e.wretch}},errorType(e){return{...this,_config:{...this._config,errorType:e}}},polyfills(e,t=0){return{...this,_config:{...this._config,polyfills:t?e:n(this._config.polyfills,e)}}},url(e,t=0){if(t)return{...this,_url:e};const r=this._url.split("?");return{...this,_url:r.length>1?r[0]+e+"?"+r[1]:this._url+e}},options(e,t=0){return{...this,_options:t?e:n(this._options,e)}},headers(e){const t=e?Array.isArray(e)?Object.fromEntries(e):"entries"in e?Object.fromEntries(e.entries()):e:{};return{...this,_options:n(this._options,{headers:t})}},accept(e){return this.headers({Accept:e})},content(t){return this.headers({[e]:t})},auth(e){return this.headers({Authorization:e})},catcher(e,t){const r=new Map(this._catchers);return r.set(e,t),{...this,_catchers:r}},catcherFallback(e){return this.catcher(r,e)},resolve(e,t=0){return{...this,_resolvers:t?[e]:[...this._resolvers,e]}},defer(e,t=0){return{...this,_deferred:t?[e]:[...this._deferred,e]}},middlewares(e,t=0){return{...this,_middlewares:t?e:[...this._middlewares,...e]}},fetch(e=this._options.method,t="",r=null){let n=this.url(t).options({method:e});const i=o(n._options.headers),c=this._config.polyfill("FormData",0),h="object"==typeof r&&!(c&&r instanceof c)&&(!n._options.headers||!i||s(i));return n=r?h?n.json(r,i):n.body(r):n,l(n._deferred.reduce(((e,t)=>t(e,e._url,e._options)),n))},get(e=""){return this.fetch("GET",e)},delete(e=""){return this.fetch("DELETE",e)},put(e,t=""){return this.fetch("PUT",t,e)},post(e,t=""){return this.fetch("POST",t,e)},patch(e,t=""){return this.fetch("PATCH",t,e)},head(e=""){return this.fetch("HEAD",e)},opts(e=""){return this.fetch("OPTIONS",e)},body(e){return{...this,_options:{...this._options,body:e}}},json(e,t){const r=o(this._options.headers);return this.content(t||s(r)&&r||"application/json").body(JSON.stringify(e))}};function u(e="",t={}){return{...h,_url:e,_options:t}}return u.default=u,u.options=function(e,t=0){i.options=t?e:n(i.options,e)},u.errorType=function(e){i.errorType=e},u.polyfills=function(e,t=0){i.polyfills=t?e:n(i.polyfills,e)},u.WretchError=c,u}));
//# sourceMappingURL=wretch.min.js.map
