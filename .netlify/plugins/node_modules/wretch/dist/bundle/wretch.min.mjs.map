{"version":3,"file":"wretch.min.mjs","sources":["../../src/constants.ts","../../src/utils.ts","../../src/config.ts","../../src/resolver.ts","../../src/middleware.ts","../../src/core.ts","../../src/index.ts"],"sourcesContent":["export const JSON_MIME = \"application/json\"\nexport const CONTENT_TYPE_HEADER = \"Content-Type\"\nexport const FETCH_ERROR = Symbol()\nexport const CATCHER_FALLBACK = Symbol()\n","import { CONTENT_TYPE_HEADER } from \"./constants.js\"\n\nexport function extractContentType(headers: HeadersInit = {}): string | undefined {\n  const normalizedHeaders = headers instanceof Array ? Object.fromEntries(headers) : headers\n  return Object.entries(normalizedHeaders).find(([k]) =>\n    k.toLowerCase() === CONTENT_TYPE_HEADER.toLowerCase()\n  )?.[1]\n}\n\nexport function isLikelyJsonMime(value: string): boolean {\n  return /^application\\/.*json.*/.test(value)\n}\n\nexport const mix = function (one: object, two: object, mergeArrays: boolean = false) {\n  return Object.entries(two).reduce((acc, [key, newValue]) => {\n    const value = one[key]\n    if (Array.isArray(value) && Array.isArray(newValue)) {\n      acc[key] = mergeArrays ? [...value, ...newValue] : newValue\n    } else if (typeof value === \"object\" && typeof newValue === \"object\") {\n      acc[key] = mix(value, newValue, mergeArrays)\n    } else {\n      acc[key] = newValue\n    }\n\n    return acc\n  }, { ...one })\n}\n","import { mix } from \"./utils.js\"\nimport type { Config, ErrorType, WretchOptions } from \"./types.js\"\n\ndeclare const global\n\nconst config: Config = {\n  // Default options\n  options: {},\n  // Error type\n  errorType: \"text\",\n  // Polyfills\n  polyfills: {\n    // fetch: null,\n    // FormData: null,\n    // URL: null,\n    // URLSearchParams: null,\n    // performance: null,\n    // PerformanceObserver: null,\n    // AbortController: null,\n  },\n  polyfill(p: string, doThrow: boolean = true, instance: boolean = false, ...args: any[]) {\n    const res = this.polyfills[p] ||\n      (typeof self !== \"undefined\" ? self[p] : null) ||\n      (typeof global !== \"undefined\" ? global[p] : null)\n    if (doThrow && !res) throw new Error(p + \" is not defined\")\n    return instance && res ? new res(...args) : res\n  }\n}\n\n/**\n * Sets the default fetch options that will be stored internally when instantiating wretch objects.\n *\n * ```js\n * import wretch from \"wretch\"\n *\n * wretch.options({ headers: { \"Accept\": \"application/json\" } });\n *\n * // The fetch request is sent with both headers.\n * wretch(\"...\", { headers: { \"X-Custom\": \"Header\" } }).get().res();\n * ```\n *\n * @param options Default options\n * @param replace If true, completely replaces the existing options instead of mixing in\n */\nexport function setOptions(options: WretchOptions, replace = false) {\n  config.options = replace ? options : mix(config.options, options)\n}\n\n/**\n * Sets the default polyfills that will be stored internally when instantiating wretch objects.\n * Useful for browserless environments like `node.js`.\n *\n * Needed for libraries like [fetch-ponyfill](https://github.com/qubyte/fetch-ponyfill).\n *\n * ```js\n * import wretch from \"wretch\"\n *\n * wretch.polyfills({\n *   fetch: require(\"node-fetch\"),\n *   FormData: require(\"form-data\"),\n *   URLSearchParams: require(\"url\").URLSearchParams,\n * });\n *\n * // Uses the above polyfills.\n * wretch(\"...\").get().res();\n * ```\n *\n * @param polyfills An object containing the polyfills\n * @param replace If true, replaces the current polyfills instead of mixing in\n */\nexport function setPolyfills(polyfills: object, replace = false) {\n  config.polyfills = replace ? polyfills : mix(config.polyfills, polyfills)\n}\n\n/**\n * Sets the default method (text, json, â€¦) used to parse the data contained in the response body in case of an HTTP error.\n * As with other static methods, it will affect wretch instances created after calling this function.\n *\n * _Note: if the response Content-Type header is set to \"application/json\", the body will be parsed as json regardless of the errorType._\n *\n * ```js\n * import wretch from \"wretch\"\n *\n * wretch.errorType(\"json\")\n *\n * wretch(\"http://server/which/returns/an/error/with/a/json/body\")\n *   .get()\n *   .res()\n *   .catch(error => {\n *     // error[errorType] (here, json) contains the parsed body\n *     console.log(error.json)\n *   })\n * ```\n *\n * If null, defaults to \"text\".\n */\nexport function setErrorType(errorType: ErrorType) {\n  config.errorType = errorType\n}\n\nexport default config\n","import { middlewareHelper } from \"./middleware.js\"\nimport { mix } from \"./utils.js\"\nimport type { Wretch, WretchResponse, WretchResponseChain, WretchError as WretchErrorType } from \"./types.js\"\nimport { FETCH_ERROR, CATCHER_FALLBACK } from \"./constants.js\"\n\n/**\n * This class inheriting from Error is thrown when the fetch response is not \"ok\".\n * It extends Error and adds status, text and body fields.\n */\nexport class WretchError extends Error implements WretchErrorType {\n  status: number\n  response: WretchResponse\n  url: string\n  text?: string\n  json?: any\n}\n\nexport const resolver = <T, Chain, R>(wretch: T & Wretch<T, Chain, R>) => {\n  const sharedState = Object.create(null)\n\n  wretch = wretch._addons.reduce((w, addon) =>\n    addon.beforeRequest &&\n    addon.beforeRequest(w, wretch._options, sharedState)\n    || w,\n  wretch)\n\n  const {\n    _url: url,\n    _options: opts,\n    _config: config,\n    _catchers: _catchers,\n    _resolvers: resolvers,\n    _middlewares: middlewares,\n    _addons: addons\n  } = wretch\n\n  const catchers = new Map(_catchers)\n  const finalOptions = mix(config.options, opts)\n\n  // The generated fetch request\n  let finalUrl = url\n  const _fetchReq = middlewareHelper(middlewares)((url, options) => {\n    finalUrl = url\n    return config.polyfill(\"fetch\")(url, options)\n  })(url, finalOptions)\n  // Throws on an http error\n  const referenceError = new Error()\n  const throwingPromise: Promise<void | WretchResponse> = _fetchReq\n    .catch(error => {\n      throw { [FETCH_ERROR]: error }\n    })\n    .then(response => {\n      if (!response.ok) {\n        const err = new WretchError()\n        // Enhance the error object\n        err[\"cause\"] = referenceError\n        err.stack = err.stack + \"\\nCAUSE: \" + referenceError.stack\n        err.response = response\n        err.status = response.status\n        err.url = finalUrl\n\n        if (response.type === \"opaque\") {\n          throw err\n        }\n\n        const jsonErrorType = config.errorType === \"json\" || response.headers.get(\"Content-Type\")?.split(\";\")[0] === \"application/json\"\n        const bodyPromise =\n          !config.errorType ? Promise.resolve(response.body) :\n            jsonErrorType ? response.text() :\n              response[config.errorType]()\n\n        return bodyPromise.then((body: unknown) => {\n          err.message = typeof body === \"string\" ? body : response.statusText\n          if(body) {\n            if(jsonErrorType && typeof body === \"string\") {\n              err.text = body\n              try { err.json = JSON.parse(body) }\n              catch { /* ignore */ }\n            } else {\n              err[config.errorType] = body\n            }\n          }\n          throw err\n        })\n      }\n      return response\n    })\n  // Wraps the Promise in order to dispatch the error to a matching catcher\n  const catchersWrapper = <T>(promise: Promise<T>): Promise<void | T> => {\n    return promise.catch(err => {\n      const fetchErrorFlag = Object.prototype.hasOwnProperty.call(err, FETCH_ERROR)\n      const error = fetchErrorFlag ? err[FETCH_ERROR] : err\n\n      const catcher =\n        (error?.status && catchers.get(error.status)) ||\n        catchers.get(error?.name) || (\n          fetchErrorFlag && catchers.has(FETCH_ERROR) && catchers.get(FETCH_ERROR)\n        )\n\n      if (catcher)\n        return catcher(error, wretch)\n\n      const catcherFallback = catchers.get(CATCHER_FALLBACK)\n      if (catcherFallback)\n        return catcherFallback(error, wretch)\n\n      throw error\n    })\n  }\n  // Enforces the proper promise type when a body parsing method is called.\n  type BodyParser = <Type>(funName: \"json\" | \"blob\" | \"formData\" | \"arrayBuffer\" | \"text\" | null) => <Result = void>(cb?: (type: Type) => Result) => Promise<Awaited<Result>>\n  const bodyParser: BodyParser = funName => cb => funName ?\n    // If a callback is provided, then callback with the body result otherwise return the parsed body itself.\n    catchersWrapper(throwingPromise.then(_ => _ && _[funName]()).then(_ => cb ? cb(_) : _)) :\n    // No body parsing method - return the response\n    catchersWrapper(throwingPromise.then(_ => cb ? cb(_ as any) : _))\n\n  const responseChain: WretchResponseChain<T, Chain, R> = {\n    _wretchReq: wretch,\n    _fetchReq,\n    _sharedState: sharedState,\n    res: bodyParser<WretchResponse>(null),\n    json: bodyParser<any>(\"json\"),\n    blob: bodyParser<Blob>(\"blob\"),\n    formData: bodyParser<FormData>(\"formData\"),\n    arrayBuffer: bodyParser<ArrayBuffer>(\"arrayBuffer\"),\n    text: bodyParser<string>(\"text\"),\n    error(errorId, cb) {\n      catchers.set(errorId, cb)\n      return this\n    },\n    badRequest(cb) { return this.error(400, cb) },\n    unauthorized(cb) { return this.error(401, cb) },\n    forbidden(cb) { return this.error(403, cb) },\n    notFound(cb) { return this.error(404, cb) },\n    timeout(cb) { return this.error(408, cb) },\n    internalError(cb) { return this.error(500, cb) },\n    fetchError(cb) { return this.error(FETCH_ERROR, cb) },\n  }\n\n  const enhancedResponseChain: R extends undefined ? Chain & WretchResponseChain<T, Chain, undefined> : R = addons.reduce((chain, addon) => ({\n    ...chain,\n    ...(typeof addon.resolver === \"function\" ? (addon.resolver as (_: WretchResponseChain<T, Chain, R>) => any)(chain) : addon.resolver)\n  }), responseChain)\n\n  return resolvers.reduce((chain, r) => r(chain, wretch), enhancedResponseChain)\n}\n","import type { ConfiguredMiddleware, FetchLike } from \"./types.js\"\n\n/**\n * @private @internal\n */\nexport const middlewareHelper = (middlewares: ConfiguredMiddleware[]) => (fetchFunction: FetchLike): FetchLike => {\n  return middlewares.reduceRight((acc, curr) => curr(acc), fetchFunction) || fetchFunction\n}\n","import { mix, extractContentType, isLikelyJsonMime } from \"./utils.js\"\nimport { JSON_MIME, CONTENT_TYPE_HEADER, CATCHER_FALLBACK } from \"./constants.js\"\nimport { resolver } from \"./resolver.js\"\nimport config from \"./config.js\"\nimport type { Wretch, ErrorType } from \"./types.js\"\n\nexport const core: Wretch = {\n  _url: \"\",\n  _options: {},\n  _config: config,\n  _catchers: new Map(),\n  _resolvers: [],\n  _deferred: [],\n  _middlewares: [],\n  _addons: [],\n  addon(addon) {\n    return { ...this, _addons: [...this._addons, addon], ...addon.wretch }\n  },\n  errorType(errorType: ErrorType) {\n    return {\n      ...this,\n      _config: {\n        ...this._config,\n        errorType\n      }\n    }\n  },\n  polyfills(polyfills, replace = false) {\n    return {\n      ...this,\n      _config: {\n        ...this._config,\n        polyfills: replace ? polyfills : mix(this._config.polyfills, polyfills)\n      }\n    }\n  },\n  url(_url, replace = false) {\n    if (replace)\n      return { ...this, _url }\n    const split = this._url.split(\"?\")\n    return {\n      ...this,\n      _url: split.length > 1 ?\n        split[0] + _url + \"?\" + split[1] :\n        this._url + _url\n    }\n  },\n  options(options, replace = false) {\n    return { ...this, _options: replace ? options : mix(this._options, options) }\n  },\n  headers(headerValues) {\n    const headers =\n      !headerValues ? {} :\n        Array.isArray(headerValues) ? Object.fromEntries(headerValues) :\n          \"entries\" in headerValues ? Object.fromEntries((headerValues as Headers).entries()) :\n            headerValues\n    return { ...this, _options: mix(this._options, { headers }) }\n  },\n  accept(headerValue) {\n    return this.headers({ Accept: headerValue })\n  },\n  content(headerValue) {\n    return this.headers({ [CONTENT_TYPE_HEADER]: headerValue })\n  },\n  auth(headerValue) {\n    return this.headers({ Authorization: headerValue })\n  },\n  catcher(errorId, catcher) {\n    const newMap = new Map(this._catchers)\n    newMap.set(errorId, catcher)\n    return { ...this, _catchers: newMap }\n  },\n  catcherFallback(catcher) {\n    return this.catcher(CATCHER_FALLBACK, catcher)\n  },\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  resolve<R = unknown>(resolver, clear: boolean = false) {\n    return { ...this, _resolvers: clear ? [resolver] : [...this._resolvers, resolver] }\n  },\n  defer(callback, clear: boolean = false) {\n    return {\n      ...this,\n      _deferred: clear ? [callback] : [...this._deferred, callback]\n    }\n  },\n  middlewares(middlewares, clear = false) {\n    return {\n      ...this,\n      _middlewares: clear ? middlewares : [...this._middlewares, ...middlewares]\n    }\n  },\n  fetch(method: string = this._options.method, url = \"\", body = null) {\n    let base = this.url(url).options({ method })\n    // \"Jsonify\" the body if it is an object and if it is likely that the content type targets json.\n    const contentType = extractContentType(base._options.headers)\n    const formDataClass = this._config.polyfill(\"FormData\", false)\n    const jsonify =\n      typeof body === \"object\" &&\n      !(formDataClass && body instanceof formDataClass) &&\n      (!base._options.headers || !contentType || isLikelyJsonMime(contentType))\n    base =\n      !body ? base :\n        jsonify ? base.json(body, contentType) :\n          base.body(body)\n    return resolver(\n      base\n        ._deferred\n        .reduce((acc: Wretch, curr) => curr(acc, acc._url, acc._options), base)\n    )\n  },\n  get(url = \"\") {\n    return this.fetch(\"GET\", url)\n  },\n  delete(url = \"\") {\n    return this.fetch(\"DELETE\", url)\n  },\n  put(body, url = \"\") {\n    return this.fetch(\"PUT\", url, body)\n  },\n  post(body, url = \"\") {\n    return this.fetch(\"POST\", url, body)\n  },\n  patch(body, url = \"\") {\n    return this.fetch(\"PATCH\", url, body)\n  },\n  head(url = \"\") {\n    return this.fetch(\"HEAD\", url)\n  },\n  opts(url = \"\") {\n    return this.fetch(\"OPTIONS\", url)\n  },\n  body(contents) {\n    return { ...this, _options: { ...this._options, body: contents } }\n  },\n  json(jsObject, contentType) {\n    const currentContentType = extractContentType(this._options.headers)\n    return this.content(\n      contentType ||\n      isLikelyJsonMime(currentContentType) && currentContentType ||\n      JSON_MIME\n    ).body(JSON.stringify(jsObject))\n  }\n}\n","import { setOptions, setErrorType, setPolyfills } from \"./config.js\"\nimport { core } from \"./core.js\"\nimport { WretchError } from \"./resolver.js\"\nimport type { Wretch, WretchOptions } from \"./types.js\"\n\nexport type {\n  Wretch,\n  Config,\n  ConfiguredMiddleware,\n  FetchLike,\n  Middleware,\n  WretchResponseChain,\n  WretchOptions,\n  WretchError,\n  WretchErrorCallback,\n  WretchResponse,\n  WretchDeferredCallback,\n  WretchAddon\n} from \"./types.js\"\n\n/**\n * Creates a new wretch instance with a base url and base\n * [fetch options](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch).\n *\n * ```ts\n * import wretch from \"wretch\"\n *\n * // Reusable instance\n * const w = wretch(\"https://domain.com\", { mode: \"cors\" })\n * ```\n *\n * @param _url The base url\n * @param _options The base fetch options\n * @returns A fresh wretch instance\n */\nfunction factory(_url = \"\", _options: WretchOptions = {}): Wretch {\n  return { ...core, _url, _options }\n}\n\nfactory[\"default\"] = factory\nfactory.options = setOptions\nfactory.errorType = setErrorType\nfactory.polyfills = setPolyfills\nfactory.WretchError = WretchError\n\nexport default factory\n"],"names":["CONTENT_TYPE_HEADER","FETCH_ERROR","Symbol","CATCHER_FALLBACK","extractContentType","headers","normalizedHeaders","Array","Object","fromEntries","_a","entries","find","k","toLowerCase","isLikelyJsonMime","value","test","mix","one","two","mergeArrays","reduce","acc","key","newValue","isArray","config","options","errorType","polyfills","polyfill","p","doThrow","instance","args","res","this","self","global","Error","WretchError","resolver","wretch","sharedState","create","_addons","w","addon","beforeRequest","_options","_url","url","opts","_config","_catchers","_resolvers","resolvers","_middlewares","middlewares","addons","catchers","Map","finalOptions","finalUrl","_fetchReq","fetchFunction","reduceRight","curr","middlewareHelper","referenceError","throwingPromise","catch","error","then","response","ok","err","stack","status","type","jsonErrorType","get","split","text","Promise","resolve","body","message","statusText","json","JSON","parse","bodyParser","funName","cb","_","fetchErrorFlag","prototype","hasOwnProperty","call","catcher","name","has","catcherFallback","responseChain","_wretchReq","_sharedState","blob","formData","arrayBuffer","errorId","set","badRequest","unauthorized","forbidden","notFound","timeout","internalError","fetchError","enhancedResponseChain","chain","r","core","_deferred","replace","length","headerValues","accept","headerValue","Accept","content","auth","Authorization","newMap","clear","defer","callback","fetch","method","base","contentType","formDataClass","jsonify","delete","put","post","patch","head","contents","jsObject","currentContentType","stringify","factory"],"mappings":"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"}