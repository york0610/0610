# 🧪 測試指南 - Bug 修復驗證

**目的**: 驗證 5 個關鍵 Bug 修復的有效性  
**預計時間**: 30-45 分鐘  
**測試環境**: Chrome/Edge (建議), Safari, Firefox

---

## 📋 測試前準備

### 1. 啟動開發伺服器
```bash
cd adhd-website
npm run dev
```

### 2. 打開瀏覽器開發工具
- **F12** 或 **右鍵 → 檢查**
- 切換到 **Console** 標籤
- 切換到 **Performance** 標籤（記憶體測試用）

### 3. 清除快取
- **Ctrl+Shift+Delete** (Windows) 或 **Cmd+Shift+Delete** (Mac)
- 清除快取和 Cookie

---

## ✅ 測試案例

### 測試 #1: 攝影機權限異步狀態

**目標**: 確認組件卸載後不會更新狀態

**步驟**:
1. 訪問 `http://localhost:3000/focus-finder/prototype`
2. 點擊「啟用鏡頭開始」
3. **立即** 點擊瀏覽器返回按鈕（在權限請求完成前）
4. 檢查 Console

**預期結果**:
- ✅ 無 React 警告訊息
- ✅ Console 顯示 `[DEBUG] Component unmounted during camera request, stopping stream`
- ✅ 攝影機指示燈熄滅

**失敗標誌**:
- ❌ 出現 "Can't perform a React state update on an unmounted component"
- ❌ 攝影機指示燈持續亮著

---

### 測試 #2: 計時器清理

**目標**: 確認所有計時器正確清理

**步驟**:
1. 訪問遊戲頁面
2. 啟用鏡頭並開始遊戲
3. 等待 5 秒（讓遊戲運行）
4. 點擊瀏覽器返回按鈕
5. 檢查 Console

**預期結果**:
- ✅ Console 顯示 `[CLEANUP] Component unmounting, cleaning up all timers and resources`
- ✅ 顯示 `[CLEANUP] Main game timer cleared`
- ✅ 顯示 `[CLEANUP] Detection interval cleared`
- ✅ 顯示 `[CLEANUP] All audio stopped`

**記憶體測試** (進階):
1. 打開 **Performance** → **Memory**
2. 點擊 **Record**
3. 重複進入/退出遊戲 10 次
4. 停止錄製
5. 檢查記憶體圖表

**預期結果**:
- ✅ 記憶體使用呈鋸齒狀（上升後下降）
- ✅ 最終記憶體接近初始值

**失敗標誌**:
- ❌ 記憶體持續上升不下降
- ❌ 計時器未清理訊息

---

### 測試 #3: 物體偵測性能

**目標**: 確認偵測循環不會重複創建

**步驟**:
1. 啟動遊戲
2. 打開 Console
3. 完成 3-5 個任務（觀察 Console 輸出）
4. 檢查 `[DETECTION]` 相關訊息

**預期結果**:
- ✅ 只看到一次 `[DETECTION] Setting up detection loop`
- ✅ 任務切換時不會重新設置偵測循環
- ✅ CPU 使用率穩定（不超過 50%）

**失敗標誌**:
- ❌ 每次任務切換都顯示 `Setting up detection loop`
- ❌ CPU 使用率持續上升
- ❌ 瀏覽器變慢或卡頓

---

### 測試 #4: 干擾任務超時保護

**目標**: 確認干擾任務 30 秒後自動解鎖

**步驟**:
1. 啟動遊戲
2. 等待干擾任務出現（通常 10-20 秒內）
3. **不要完成干擾任務**
4. 等待 30 秒
5. 觀察畫面和 Console

**預期結果**:
- ✅ 30 秒後顯示 `[BUG FIX] Distraction task timeout - auto-unlocking after 30s`
- ✅ 主任務卡片恢復正常（不再半透明）
- ✅ 可以繼續完成主任務
- ✅ 顯示警告訊息「⚠️ 干擾任務已自動跳過」

**失敗標誌**:
- ❌ 30 秒後仍然鎖定
- ❌ 無法繼續遊戲
- ❌ 沒有警告訊息

---

### 測試 #5: 全螢幕自動退出

**目標**: 確認遊戲結束後自動退出全螢幕

**步驟**:
1. 啟動遊戲（會自動進入全螢幕）
2. 等待 90 秒讓遊戲自然結束
3. 觀察結算畫面
4. 等待 5 秒

**預期結果**:
- ✅ 結算畫面在全螢幕中顯示
- ✅ 5 秒後自動退出全螢幕
- ✅ Console 顯示 `[FULLSCREEN] Auto-exiting fullscreen after game end`

**替代測試** (死亡結束):
1. 啟動遊戲
2. 故意讓專注力降到 0（不完成任務）
3. 觀察死亡動畫
4. 等待 5 秒

**失敗標誌**:
- ❌ 5 秒後仍在全螢幕
- ❌ 需要手動按 ESC 退出
- ❌ 無法退出全螢幕

---

## 📊 測試結果記錄

### 測試環境
- 瀏覽器: _______________
- 版本: _______________
- 作業系統: _______________
- 日期: _______________

### 測試結果

| 測試案例 | 通過 | 失敗 | 備註 |
|---------|------|------|------|
| #1 攝影機權限 | ☐ | ☐ | |
| #2 計時器清理 | ☐ | ☐ | |
| #3 物體偵測性能 | ☐ | ☐ | |
| #4 干擾任務超時 | ☐ | ☐ | |
| #5 全螢幕退出 | ☐ | ☐ | |

### 整體評估
- **通過率**: _____ / 5
- **建議**: _______________

---

## 🐛 問題回報

如果發現問題，請記錄：

1. **問題描述**: _______________
2. **重現步驟**: _______________
3. **預期行為**: _______________
4. **實際行為**: _______________
5. **Console 錯誤**: _______________
6. **截圖**: (如有)

---

## 📝 額外測試 (可選)

### 長時間穩定性測試
- 連續遊玩 30 分鐘
- 檢查記憶體和性能

### 多瀏覽器測試
- Chrome ✓
- Safari ☐
- Firefox ☐
- Edge ☐

### 移動端測試
- iOS Safari ☐
- Android Chrome ☐

---

**測試完成後**: 請將結果回報給開發團隊

