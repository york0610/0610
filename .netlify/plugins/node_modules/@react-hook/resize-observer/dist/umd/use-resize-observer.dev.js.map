{"version":3,"file":"use-resize-observer.dev.js","sources":["../../node_modules/@react-hook/passive-layout-effect/dist/module/index.js","../../node_modules/@react-hook/latest/dist/module/index.js","../../src/index.tsx"],"sourcesContent":["import * as React from 'react';\nconst usePassiveLayoutEffect = React[typeof document !== 'undefined' && document.createElement !== void 0 ? 'useLayoutEffect' : 'useEffect'];\nexport default usePassiveLayoutEffect;","import * as React from 'react';\n\nconst useLatest = current => {\n  const storedValue = React.useRef(current);\n  storedValue.current = current;\n  return storedValue;\n};\n\nexport default useLatest;","/* eslint-disable no-return-assign */\n/* eslint-disable no-underscore-dangle */\nimport * as React from 'react'\nimport useLayoutEffect from '@react-hook/passive-layout-effect'\nimport useLatest from '@react-hook/latest'\n\n/**\n * A React hook that fires a callback whenever ResizeObserver detects a change to its size\n *\n * @param target A React ref created by `useRef()` or an HTML element\n * @param callback Invoked with a single `ResizeObserverEntry` any time\n *   the `target` resizes\n */\nfunction useResizeObserver<T extends Element>(\n  target: React.RefObject<T> | React.ForwardedRef<T> | T | null,\n  callback: UseResizeObserverCallback,\n  options: UseResizeObserverOptions = {}\n): ResizeObserver {\n  const resizeObserver = getResizeObserver(options.polyfill)\n  const storedCallback = useLatest(callback)\n\n  useLayoutEffect(() => {\n    let didUnsubscribe = false\n    const targetEl = target && 'current' in target ? target.current : target\n    if (!targetEl) return () => {}\n\n    function cb(entry: ResizeObserverEntry, observer: ResizeObserver) {\n      if (didUnsubscribe) return\n      storedCallback.current(entry, observer)\n    }\n\n    resizeObserver.subscribe(targetEl as Element, cb)\n\n    return () => {\n      didUnsubscribe = true\n      resizeObserver.unsubscribe(targetEl as Element, cb)\n    }\n  }, [target, resizeObserver, storedCallback])\n\n  return resizeObserver.observer\n}\n\nfunction createResizeObserver(polyfill?: any) {\n  let ticking = false\n  let allEntries: ResizeObserverEntry[] = []\n\n  const callbacks: Map<any, Array<UseResizeObserverCallback>> = new Map()\n\n  const observer = new (polyfill || window.ResizeObserver)(\n    (entries: ResizeObserverEntry[], obs: ResizeObserver) => {\n      allEntries = allEntries.concat(entries)\n      if (!ticking) {\n        window.requestAnimationFrame(() => {\n          const triggered = new Set<Element>()\n          for (let i = 0; i < allEntries.length; i++) {\n            if (triggered.has(allEntries[i].target)) continue\n            triggered.add(allEntries[i].target)\n            const cbs = callbacks.get(allEntries[i].target)\n            cbs?.forEach((cb) => cb(allEntries[i], obs))\n          }\n          allEntries = []\n          ticking = false\n        })\n      }\n      ticking = true\n    }\n  )\n\n  return {\n    observer,\n    subscribe(target: Element, callback: UseResizeObserverCallback) {\n      observer.observe(target)\n      const cbs = callbacks.get(target) ?? []\n      cbs.push(callback)\n      callbacks.set(target, cbs)\n    },\n    unsubscribe(target: Element, callback: UseResizeObserverCallback) {\n      const cbs = callbacks.get(target) ?? []\n      if (cbs.length === 1) {\n        observer.unobserve(target)\n        callbacks.delete(target)\n        return\n      }\n      const cbIndex = cbs.indexOf(callback)\n      if (cbIndex !== -1) cbs.splice(cbIndex, 1)\n      callbacks.set(target, cbs)\n    },\n  }\n}\n\nlet _resizeObserver: ReturnType<typeof createResizeObserver>\n\nconst getResizeObserver = (polyfill: any) =>\n  !_resizeObserver\n    ? (_resizeObserver = createResizeObserver(polyfill))\n    : _resizeObserver\n\nexport type UseResizeObserverCallback = (\n  entry: ResizeObserverEntry,\n  observer: ResizeObserver\n) => any\n\nexport type UseResizeObserverOptions = {polyfill?: any}\nexport default useResizeObserver\n"],"names":["usePassiveLayoutEffect","React","document","createElement","useLatest","current","storedValue","useRef","_ref","useResizeObserver","target","callback","options","resizeObserver","getResizeObserver","polyfill","storedCallback","useLayoutEffect","didUnsubscribe","targetEl","cb","entry","observer","subscribe","unsubscribe","createResizeObserver","ticking","allEntries","callbacks","Map","window","ResizeObserver","entries","obs","concat","_ref2","triggered","Set","_loop","i","has","add","cbs","get","forEach","length","_ret","requestAnimationFrame","_callbacks$get","observe","push","set","_callbacks$get2","unobserve","delete","cbIndex","indexOf","splice","_resizeObserver"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;EACA,IAAMA,sBAAsB,GAAGC,gBAAK,CAAC,OAAOC,QAAQ,KAAK,WAAW,IAAIA,QAAQ,CAACC,aAAa,KAAK,KAAK,CAAC,GAAG,iBAAiB,GAAG,WAAW,CAAC;;ECC5I,IAAMC,SAAS,GAAG,SAAZA,SAASA,CAAGC,OAAO,EAAI;EAC3B,EAAA,IAAMC,WAAW,GAAGL,gBAAK,CAACM,MAAM,CAACF,OAAO,CAAC,CAAA;IACzCC,WAAW,CAACD,OAAO,GAAGA,OAAO,CAAA;EAC7B,EAAA,OAAOC,WAAW,CAAA;EACpB,CAAC;;ECND;;EAMA;EACA;EACA;EACA;EACA;EACA;EACA;;EAY0B,SAAAE,IAAAA,GAAM,EAAC;EAXjC,SAASC,iBAAiBA,CACxBC,MAA6D,EAC7DC,QAAmC,EACnCC,OAAiC,EACjB;EAAA,EAAA,IADhBA,OAAiC,KAAA,KAAA,CAAA,EAAA;MAAjCA,OAAiC,GAAG,EAAE,CAAA;EAAA,GAAA;EAEtC,EAAA,IAAMC,cAAc,GAAGC,iBAAiB,CAACF,OAAO,CAACG,QAAQ,CAAC,CAAA;EAC1D,EAAA,IAAMC,cAAc,GAAGZ,SAAS,CAACO,QAAQ,CAAC,CAAA;EAE1CM,EAAAA,sBAAe,CAAC,YAAM;MACpB,IAAIC,cAAc,GAAG,KAAK,CAAA;EAC1B,IAAA,IAAMC,QAAQ,GAAGT,MAAM,IAAI,SAAS,IAAIA,MAAM,GAAGA,MAAM,CAACL,OAAO,GAAGK,MAAM,CAAA;EACxE,IAAA,IAAI,CAACS,QAAQ,EAAE,OAAAX,IAAA,CAAA;EAEf,IAAA,SAASY,EAAEA,CAACC,KAA0B,EAAEC,QAAwB,EAAE;EAChE,MAAA,IAAIJ,cAAc,EAAE,OAAA;EACpBF,MAAAA,cAAc,CAACX,OAAO,CAACgB,KAAK,EAAEC,QAAQ,CAAC,CAAA;EACzC,KAAA;EAEAT,IAAAA,cAAc,CAACU,SAAS,CAACJ,QAAQ,EAAaC,EAAE,CAAC,CAAA;EAEjD,IAAA,OAAO,YAAM;EACXF,MAAAA,cAAc,GAAG,IAAI,CAAA;EACrBL,MAAAA,cAAc,CAACW,WAAW,CAACL,QAAQ,EAAaC,EAAE,CAAC,CAAA;OACpD,CAAA;KACF,EAAE,CAACV,MAAM,EAAEG,cAAc,EAAEG,cAAc,CAAC,CAAC,CAAA;IAE5C,OAAOH,cAAc,CAACS,QAAQ,CAAA;EAChC,CAAA;EAEA,SAASG,oBAAoBA,CAACV,QAAc,EAAE;IAC5C,IAAIW,OAAO,GAAG,KAAK,CAAA;IACnB,IAAIC,UAAiC,GAAG,EAAE,CAAA;EAE1C,EAAA,IAAMC,SAAqD,GAAG,IAAIC,GAAG,EAAE,CAAA;EAEvE,EAAA,IAAMP,QAAQ,GAAG,KAAKP,QAAQ,IAAIe,MAAM,CAACC,cAAc,EACrD,UAACC,OAA8B,EAAEC,GAAmB,EAAK;EACvDN,IAAAA,UAAU,GAAGA,UAAU,CAACO,MAAM,CAACF,OAAO,CAAC,CAAA;EAER,IAAA,SAAAG,QAAM;EACjC,MAAA,IAAMC,SAAS,GAAG,IAAIC,GAAG,EAAW,CAAA;QAAA,IAAAC,KAAA,GAAAA,SAAAA,KAAAA,CAC3BC,CAAC,EAAA;UACR,IAAIH,SAAS,CAACI,GAAG,CAACb,UAAU,CAACY,CAAC,CAAC,CAAC7B,MAAM,CAAC,EAAE,OAAA,UAAA,CAAA;UACzC0B,SAAS,CAACK,GAAG,CAACd,UAAU,CAACY,CAAC,CAAC,CAAC7B,MAAM,CAAC,CAAA;EACnC,QAAA,IAAMgC,GAAG,GAAGd,SAAS,CAACe,GAAG,CAAChB,UAAU,CAACY,CAAC,CAAC,CAAC7B,MAAM,CAAC,CAAA;UAC/CgC,GAAG,KAAA,IAAA,IAAHA,GAAG,KAAHA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,GAAG,CAAEE,OAAO,CAAC,UAACxB,EAAE,EAAA;YAAA,OAAKA,EAAE,CAACO,UAAU,CAACY,CAAC,CAAC,EAAEN,GAAG,CAAC,CAAA;WAAC,CAAA,CAAA;EAAA,OAAA,CAAA;EAJ9C,MAAA,KAAK,IAAIM,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGZ,UAAU,CAACkB,MAAM,EAAEN,CAAC,EAAE,EAAE;EAAA,QAAA,IAAAO,IAAA,GAAAR,KAAA,CAAnCC,CAAC,CAAA,CAAA;EAAA,QAAA,IAAAO,IAAA,KACiC,UAAA,EAAA,SAAA;EAI3C,OAAA;EACAnB,MAAAA,UAAU,GAAG,EAAE,CAAA;EACfD,MAAAA,OAAO,GAAG,KAAK,CAAA;EACjB,KAAA;MAXF,IAAI,CAACA,OAAO,EAAE;EACZI,MAAAA,MAAM,CAACiB,qBAAqB,CAAAZ,KAU3B,CAAC,CAAA;EACJ,KAAA;EACAT,IAAAA,OAAO,GAAG,IAAI,CAAA;EAChB,GACF,CAAC,CAAA;IAED,OAAO;EACLJ,IAAAA,QAAQ,EAARA,QAAQ;EACRC,IAAAA,SAAS,EAAAA,SAAAA,SAAAA,CAACb,MAAe,EAAEC,QAAmC,EAAE;EAAA,MAAA,IAAAqC,cAAA,CAAA;EAC9D1B,MAAAA,QAAQ,CAAC2B,OAAO,CAACvC,MAAM,CAAC,CAAA;EACxB,MAAA,IAAMgC,GAAG,GAAA,CAAAM,cAAA,GAAGpB,SAAS,CAACe,GAAG,CAACjC,MAAM,CAAC,MAAAsC,IAAAA,IAAAA,cAAA,KAAAA,KAAAA,CAAAA,GAAAA,cAAA,GAAI,EAAE,CAAA;EACvCN,MAAAA,GAAG,CAACQ,IAAI,CAACvC,QAAQ,CAAC,CAAA;EAClBiB,MAAAA,SAAS,CAACuB,GAAG,CAACzC,MAAM,EAAEgC,GAAG,CAAC,CAAA;OAC3B;EACDlB,IAAAA,WAAW,EAAAA,SAAAA,WAAAA,CAACd,MAAe,EAAEC,QAAmC,EAAE;EAAA,MAAA,IAAAyC,eAAA,CAAA;EAChE,MAAA,IAAMV,GAAG,GAAA,CAAAU,eAAA,GAAGxB,SAAS,CAACe,GAAG,CAACjC,MAAM,CAAC,MAAA0C,IAAAA,IAAAA,eAAA,KAAAA,KAAAA,CAAAA,GAAAA,eAAA,GAAI,EAAE,CAAA;EACvC,MAAA,IAAIV,GAAG,CAACG,MAAM,KAAK,CAAC,EAAE;EACpBvB,QAAAA,QAAQ,CAAC+B,SAAS,CAAC3C,MAAM,CAAC,CAAA;EAC1BkB,QAAAA,SAAS,CAAC0B,MAAM,CAAC5C,MAAM,CAAC,CAAA;EACxB,QAAA,OAAA;EACF,OAAA;EACA,MAAA,IAAM6C,OAAO,GAAGb,GAAG,CAACc,OAAO,CAAC7C,QAAQ,CAAC,CAAA;EACrC,MAAA,IAAI4C,OAAO,KAAK,CAAC,CAAC,EAAEb,GAAG,CAACe,MAAM,CAACF,OAAO,EAAE,CAAC,CAAC,CAAA;EAC1C3B,MAAAA,SAAS,CAACuB,GAAG,CAACzC,MAAM,EAAEgC,GAAG,CAAC,CAAA;EAC5B,KAAA;KACD,CAAA;EACH,CAAA;EAEA,IAAIgB,eAAwD,CAAA;EAE5D,IAAM5C,iBAAiB,GAAG,SAApBA,iBAAiBA,CAAIC,QAAa,EAAA;IAAA,OACtC,CAAC2C,eAAe,GACXA,eAAe,GAAGjC,oBAAoB,CAACV,QAAQ,CAAC,GACjD2C,eAAe,CAAA;EAAA,CAAA;;;;;;;;"}